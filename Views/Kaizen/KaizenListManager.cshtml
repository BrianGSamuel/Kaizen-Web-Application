@model IEnumerable<KaizenWebApp.Models.KaizenForm>

@{
    ViewData["Title"] = "Kaizen Suggestions Management";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .kaizen-list-header {
        background: linear-gradient(135deg, #E31E24 0%, #c41e3a 100%);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(227, 30, 36, 0.3);
    }

    body {
        background-color: #f8f9fa;
    }

    .search-section {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .search-form {
        display: flex;
        gap: 1rem;
        align-items: end;
        flex-wrap: wrap;
    }

    .search-input-group {
        flex: 1;
        min-width: 250px;
    }

    .status-select-group {
        min-width: 200px;
    }

    .btn-search {
        background: linear-gradient(135deg, var(--primary-red) 0%, #c41e3a 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

        .btn-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(227, 30, 36, 0.4);
            color: white;
        }

    .btn-clear {
        background: var(--secondary-gray);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

        .btn-clear:hover {
            background: #555;
            color: white;
            transform: translateY(-2px);
        }

    .table-container {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .kaizen-table {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

        .kaizen-table thead {
            background: linear-gradient(135deg, var(--primary-red) 0%, #c41e3a 100%);
            color: white;
        }

        .kaizen-table th {
            border: none;
            padding: 1rem;
            font-weight: 600;
            text-align: center;
            vertical-align: middle;
        }

        .kaizen-table td {
            border: none;
            border-bottom: 1px solid #f0f0f0;
            padding: 1rem;
            vertical-align: middle;
        }

        .kaizen-table tbody tr {
            transition: all 0.3s ease;
        }

            .kaizen-table tbody tr:hover {
                background-color: #f8f9fa;
                transform: translateY(-1px);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

    .btn-approve {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-size: 0.875rem;
        margin-right: 0.25rem;
    }

        .btn-approve:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
            color: white;
        }

    .btn-reject {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-size: 0.875rem;
        margin-right: 0.25rem;
    }

        .btn-reject:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
            color: white;
        }

    .btn-approval {
        background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.4rem 0.8rem;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-size: 0.8rem;
        margin-right: 0.25rem;
    }

        .btn-approval:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(111, 66, 193, 0.4);
            color: white;
        }



    .btn-view {
        background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-size: 0.875rem;
        margin-right: 0.25rem;
    }

        .btn-view:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(23, 162, 184, 0.4);
            color: white;
        }

    .btn-edit {
        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        border: none;
        color: #212529;
        font-weight: 700;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
        border: 2px solid #e0a800;
    }

        .btn-edit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 193, 7, 0.5);
            color: #212529;
            background: linear-gradient(135deg, #ffca2c 0%, #e0a800 100%);
            border-color: #d39e00;
        }

    .btn-executive {
        background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%);
        border: none;
        color: white;
        font-weight: 700;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        box-shadow: 0 2px 8px rgba(111, 66, 193, 0.3);
        border: 2px solid #5a2d91;
    }

        .btn-executive:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(111, 66, 193, 0.5);
            color: white;
            background: linear-gradient(135deg, #7c4dcc 0%, #6f42c1 100%);
            border-color: #5a2d91;
        }

    .btn-manager {
        background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        border: none;
        color: white;
        font-weight: 700;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        box-shadow: 0 2px 8px rgba(23, 162, 184, 0.3);
        border: 2px solid #138496;
    }

        .btn-manager:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(23, 162, 184, 0.5);
            color: white;
            background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%);
            border-color: #138496;
        }

    .status-pending {
        background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        color: #212529;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.875rem;
    }

    .status-approved {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.875rem;
    }

    .status-rejected {
        background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.875rem;
    }

    .cost-saving {
        font-weight: 600;
        color: var(--success-green);
    }

    .no-data-alert {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border: none;
        border-radius: 10px;
        padding: 2rem;
        text-align: center;
        color: #1976d2;
    }

    .success-alert {
        background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
        border: none;
        border-radius: 10px;
        color: var(--success-green);
    }

    .modal-content {
        border-radius: 15px;
        border: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
        background: linear-gradient(135deg, var(--primary-red) 0%, #c41e3a 100%);
        color: white;
        border-radius: 15px 15px 0 0;
        border: none;
    }

    .modal-title {
        font-weight: 600;
    }

    .form-label {
        font-weight: 600;
        color: var(--secondary-gray);
        margin-bottom: 0.5rem;
    }

    .form-control, .form-select {
        border-radius: 8px;
        border: 2px solid #e9ecef;
        padding: 0.75rem;
        transition: all 0.3s ease;
    }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-red);
            box-shadow: 0 0 0 0.2rem rgba(227, 30, 36, 0.25);
        }

    .btn-update {
        background: linear-gradient(135deg, var(--primary-red) 0%, #c41e3a 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

        .btn-update:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(227, 30, 36, 0.4);
            color: white;
        }

    .image-preview {
        border-radius: 8px;
        border: 2px solid #e9ecef;
        padding: 0.5rem;
        background: #f8f9fa;
    }

    /* Read-only styling for executive filling form */
    .form-control[readonly], .form-control[disabled] {
        background-color: #f8f9fa;
        color: #495057;
        border-color: #ced4da;
        cursor: not-allowed;
    }

    .form-check-input[disabled] {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .form-check-input[disabled]:checked {
        background-color: #6c757d;
        border-color: #6c757d;
    }

    @@media (max-width: 768px) {
        .search-form {
            flex-direction: column;
            align-items: stretch;
        }

        .search-input-group,
        .status-select-group {
            min-width: auto;
        }

        .kaizen-table {
            font-size: 0.875rem;
        }

            .kaizen-table th,
            .kaizen-table td {
                padding: 0.75rem 0.5rem;
            }
    }
</style>

<div class="container-fluid">
    <!-- Header Section -->
    <div class="kaizen-list-header text-center">
        <div class="row align-items-center">
            <div class="col-md-8 mx-auto">
                <h1 class="display-5 fw-bold mb-3">
                    <i class="fas fa-tasks me-3"></i>Kaizen Management
                </h1>
                <p class="lead mb-0">Review and manage engineer-approved Kaizen suggestions with executive filling</p>
            </div>
        </div>
    </div>

    <!-- Search Section -->
    <div class="search-section">
        <div class="row">
            <div class="col-12">
                <div class="search-form">
                    <div class="search-input-group">
                        <label for="searchString" class="form-label">
                            <i class="fas fa-search me-2"></i>Search
                        </label>
                        <input type="text" id="searchString" class="form-control"
                               placeholder="Search by Kaizen No, Employee Name, or Employee No..." />
                    </div>
                    <div class="status-select-group">
                        <label for="status" class="form-label">
                            <i class="fas fa-info-circle me-2"></i>Manager Status
                        </label>
                        <select id="status" class="form-select">
                            <option value="">All Status</option>
                            <option value="Approved">Approved</option>
                            <option value="Rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="button" id="clearBtn" class="btn btn-clear">
                            <i class="fas fa-times me-2"></i>Clear
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Table Section -->
    <div class="table-container">
        <div id="searchResults">
            @if (!Model?.Any() ?? true)
            {
                <div class="no-data-alert">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <h4>No Kaizen suggestions available</h4>
                    <p class="mb-0">Start typing to search for Kaizen suggestions</p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table kaizen-table">
                        <thead>
                            <tr>
                                <th><i class="fas fa-calendar me-2"></i>Date Submitted</th>
                                <th><i class="fas fa-hashtag me-2"></i>Kaizen No</th>
                                <th><i class="fas fa-building me-2"></i>Department Name</th>
                                <th><i class="fas fa-user me-2"></i>Employee Name</th>
                                <th><i class="fas fa-id-badge me-2"></i>Employee No</th>
                                <th><i class="fas fa-coins me-2"></i>Cost Saving</th>
                                <th><i class="fas fa-info-circle me-2"></i>Manager Status</th>
                                <th><i class="fas fa-cogs me-2"></i>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td class="text-center">@item.DateSubmitted.ToString("yyyy-MM-dd")</td>
                                    <td class="text-center fw-bold">@Html.DisplayFor(modelItem => item.KaizenNo)</td>
                                    <td class="text-center">@Html.DisplayFor(modelItem => item.Department)</td>
                                    <td>@Html.DisplayFor(modelItem => item.EmployeeName)</td>
                                    <td class="text-center">@Html.DisplayFor(modelItem => item.EmployeeNo)</td>
                                    <td class="text-center cost-saving">
                                        @(item.CostSaving.HasValue ? $"$ {item.CostSaving.Value:N2}" : "N/A")
                                    </td>
                                    <td class="text-center">
                                        @{
                                            var managerStatus = item.ManagerStatus ?? "Pending";
                                            var statusClass = managerStatus switch
                                            {
                                                "Approved" => "status-approved",
                                                "Rejected" => "status-rejected",
                                                _ => "status-pending"
                                            };
                                        }
                                        <span class="@statusClass">@managerStatus</span>
                                    </td>
                                    <td class="text-center">
                                        <button class="btn btn-view" onclick="viewKaizen(@item.Id)">
                                            <i class="fas fa-eye me-1"></i>View
                                        </button>
                                        @if ((item.ManagerStatus ?? "Pending") == "Pending")
                                        {
                                            <button class="btn btn-approval" onclick="showApprovalPopup(@item.Id)">
                                                <i class="fas fa-gavel me-1"></i>Approval
                                            </button>
                                        }

                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editKaizenModal" tabindex="-1" aria-labelledby="editKaizenModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <div class="d-flex align-items-center">
                    <h5 class="modal-title mb-0" id="editKaizenModalLabel">
                        <i class="fas fa-eye me-2"></i>View Kaizen Suggestion
                    </h5>
                    <button type="button" class="btn btn-executive ms-2" id="executiveFillingBtn" onclick="executiveFilling()" style="display: none;">
                        <i class="fas fa-user-tie me-1"></i>Executive Filling
                    </button>
                    <button type="button" class="btn btn-manager ms-2" id="managerCommentBtn" onclick="managerComment()" style="display: none;">
                        <i class="fas fa-comments me-1"></i>Add Manager Comment
                    </button>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editKaizenForm" enctype="multipart/form-data">
                    <input type="hidden" id="editKaizenId" name="Id" />

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editDateSubmitted" class="form-label">
                                <i class="fas fa-calendar me-2"></i>Date Submitted
                            </label>
                            <input type="date" id="editDateSubmitted" name="DateSubmitted" class="form-control" required />
                            <span class="text-danger field-validation-error" data-valmsg-for="DateSubmitted"></span>
                        </div>
                        <div class="col-md-6">
                            <label for="editDateImplemented" class="form-label">
                                <i class="fas fa-calendar-check me-2"></i>Date Implemented
                            </label>
                            <input type="date" id="editDateImplemented" name="DateImplemented" class="form-control" />
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editKaizenNo" class="form-label">
                                <i class="fas fa-hashtag me-2"></i>Kaizen No
                            </label>
                            <input type="text" id="editKaizenNo" name="KaizenNo" class="form-control" readonly />
                        </div>
                        <div class="col-md-6">
                            <label for="editDepartment" class="form-label">
                                <i class="fas fa-building me-2"></i>Department Name
                            </label>
                            <input type="text" id="editDepartment" name="Department" class="form-control" required />
                            <span class="text-danger field-validation-error" data-valmsg-for="Department"></span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editEmployeeName" class="form-label">
                                <i class="fas fa-user me-2"></i>Employee Name
                            </label>
                            <input type="text" id="editEmployeeName" name="EmployeeName" class="form-control" required />
                            <span class="text-danger field-validation-error" data-valmsg-for="EmployeeName"></span>
                        </div>
                        <div class="col-md-6">
                            <label for="editEmployeeNo" class="form-label">
                                <i class="fas fa-id-badge me-2"></i>Employee No
                            </label>
                            <input type="text" id="editEmployeeNo" name="EmployeeNo" class="form-control" required />
                            <span class="text-danger field-validation-error" data-valmsg-for="EmployeeNo"></span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="editSuggestionDescription" class="form-label">
                            <i class="fas fa-lightbulb me-2"></i>Kaizen Suggestion Description
                        </label>
                        <textarea id="editSuggestionDescription" name="SuggestionDescription" class="form-control" rows="3" required></textarea>
                        <span class="text-danger field-validation-error" data-valmsg-for="SuggestionDescription"></span>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="editBeforeKaizenImage" class="form-label">
                                <i class="fas fa-image me-2"></i>Before Kaizen Image
                            </label>
                            <div id="editBeforeKaizenImageContainer" class="mb-2" style="display: none;">
                                <label class="form-label text-muted">Current Image:</label>
                                <div class="image-preview text-center">
                                    <img id="editBeforeKaizenCurrentImage" src="" alt="Before Kaizen" class="img-fluid rounded" style="max-height: 150px; max-width: 100%;" />
                                </div>
                            </div>
                            <input type="file" id="editBeforeKaizenImage" name="BeforeKaizenImage" class="form-control" accept="image/*" />
                            <small class="form-text text-muted">Leave empty to keep the current image</small>
                        </div>
                        <div class="col-md-6">
                            <label for="editAfterKaizenImage" class="form-label">
                                <i class="fas fa-image me-2"></i>After Kaizen Image
                            </label>
                            <div id="editAfterKaizenImageContainer" class="mb-2" style="display: none;">
                                <label class="form-label text-muted">Current Image:</label>
                                <div class="image-preview text-center">
                                    <img id="editAfterKaizenCurrentImage" src="" alt="After Kaizen" class="img-fluid rounded" style="max-height: 150px; max-width: 100%;" />
                                </div>
                            </div>
                            <input type="file" id="editAfterKaizenImage" name="AfterKaizenImage" class="form-control" accept="image/*" />
                            <small class="form-text text-muted">Leave empty to keep the current image</small>
                        </div>
                    </div>

                    <!-- Cost Saving Section -->
                    <div class="mb-3" style="border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 20px; background-color: #f8f9fa;">
                        <h6 class="mb-3">
                            <i class="fas fa-coins me-2"></i>Cost Saving Information
                        </h6>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-coins me-2"></i>Cost Saving ($ per year)
                                </label>
                                <input type="text" id="editCostSavingDisplay" class="form-control" readonly />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">
                                    <i class="fas fa-dollar-sign me-2"></i>Current Dollar Rate
                                </label>
                                <input type="text" id="editDollarRateDisplay" class="form-control" readonly />
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="editOtherBenefits" class="form-label">
                            <i class="fas fa-star me-2"></i>Other Benefits
                        </label>
                        <textarea id="editOtherBenefits" name="OtherBenefits" class="form-control" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Close
                </button>
                <button type="button" class="btn btn-update" id="saveEditBtn" onclick="saveKaizenEdit()" style="display: none;">
                    <i class="fas fa-save me-2"></i>Update Suggestion
                </button>
            </div>
        </div>
    </div>
</div>



<!-- Enhanced Edit Modal -->
<div class="modal fade" id="enhancedEditModal" tabindex="-1" aria-labelledby="enhancedEditModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="enhancedEditModalLabel">
                    <i class="fas fa-user-tie me-2"></i>Executive/Engineer Review
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="enhancedEditForm" enctype="multipart/form-data">
                    @Html.AntiForgeryToken()
                    <input type="hidden" id="enhancedEditKaizenId" name="Id" />

                    <!-- Hidden required fields to ensure they're included in form submission -->
                    <input type="hidden" id="enhancedEditKaizenNoHidden" name="KaizenNo" />
                    <input type="hidden" id="enhancedEditEmployeeNoHidden" name="EmployeeNo" />
                    <input type="hidden" id="enhancedEditEmployeeNameHidden" name="EmployeeName" />
                    <input type="hidden" id="enhancedEditSuggestionDescriptionHidden" name="SuggestionDescription" />
                    <input type="hidden" id="enhancedEditDateSubmittedHidden" name="DateSubmitted" />



                    <!-- Executive/Engineer Form Section -->
                    <div class="mb-4" style="border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; background-color: #f8f9fa;">
                        <h6 class="mb-3">
                            <i class="fas fa-user-tie me-2"></i>Executive/Engineer Review
                        </h6>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="enhancedEditCategory" class="form-label">
                                    <i class="fas fa-folder me-2"></i>Recommended Categories
                                </label>
                                <div class="mt-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input category-checkbox" type="checkbox" name="Category" id="enhanced_categoryCostSaving" value="Cost reduction" disabled>
                                    <label class="form-check-label" for="enhanced_categoryCostSaving">Major Cost reduction by innovation</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input category-checkbox" type="checkbox" name="Category" id="enhanced_categoryProductivity" value="Productivity Improvement" disabled>
                                    <label class="form-check-label" for="enhanced_categoryProductivity">Productivity Improvement</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input category-checkbox" type="checkbox" name="Category" id="enhanced_categoryOHS" value="OHS Improvement" disabled>
                                    <label class="form-check-label" for="enhanced_categoryOHS">OHS Improvement</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input category-checkbox" type="checkbox" name="Category" id="enhanced_categoryQuality" value="Quality Improvements" disabled>
                                    <label class="form-check-label" for="enhanced_categoryQuality">Quality Improvements</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input category-checkbox" type="checkbox" name="Category" id="enhanced_categoryEnvironment" value="Environmental friendly" disabled>
                                    <label class="form-check-label" for="enhanced_categoryEnvironment">Environmental friendly Innovation</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input category-checkbox" type="checkbox" name="Category" id="enhanced_category5S" value="5S Improvement" disabled>
                                    <label class="form-check-label" for="enhanced_category5S">5S Improvement</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input category-checkbox" type="checkbox" name="Category" id="enhanced_categoryErgonomics" value="Ergonomics Improvements" disabled>
                                    <label class="form-check-label" for="enhanced_categoryErgonomics">Ergonomics Improvements</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input category-checkbox" type="checkbox" name="Category" id="enhanced_categoryEnergySaving" value="Energy Saving Improvement" disabled>
                                    <label class="form-check-label" for="enhanced_categoryEnergySaving">Energy Saving Improvement</label>
                                </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="enhancedEditApprovedBy" class="form-label">
                                    <i class="fas fa-signature me-2"></i>Signature (Add Name)
                                </label>
                                <input type="text" id="enhancedEditApprovedBy" name="ApprovedBy" class="form-control" placeholder="Enter your name" readonly />
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="enhancedEditComments" class="form-label">
                                <i class="fas fa-comments me-2"></i>Comment & Recommendations
                            </label>
                            <textarea id="enhancedEditComments" name="Comments" class="form-control" rows="4" placeholder="Enter your comments and recommendations..." readonly></textarea>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">
                                <i class="fas fa-question-circle me-2"></i>Can this suggestion be implemented in other fields?
                            </label>
                            <div class="mt-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="CanImplementInOtherFields" id="enhanced_implementYes" value="Yes" onchange="toggleEnhancedImplementationArea()" disabled>
                                    <label class="form-check-label" for="enhanced_implementYes">Yes</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="CanImplementInOtherFields" id="enhanced_implementNo" value="No" onchange="toggleEnhancedImplementationArea()" disabled>
                                    <label class="form-check-label" for="enhanced_implementNo">No</label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3" id="implementationAreaField" style="display: none;">
                            <label for="enhancedEditImplementationArea" class="form-label">
                                <i class="fas fa-map-marker-alt me-2"></i>Specify Area
                            </label>
                            <input type="text" id="enhancedEditImplementationArea" name="ImplementationArea" class="form-control" placeholder="Enter the specific area where this can be implemented..." readonly />
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Close
                </button>
                <button type="button" class="btn btn-executive" id="saveExecutiveBtn" onclick="saveExecutiveFilling()" style="display: none;">
                    <i class="fas fa-save me-2"></i>Save Executive Review
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Approval Popup Modal -->
<div class="modal fade" id="approvalModal" tabindex="-1" aria-labelledby="approvalModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="approvalModalLabel">
                    <i class="fas fa-gavel me-2"></i>Kaizen Approval
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <div class="mb-4">
                    <i class="fas fa-question-circle fa-3x text-primary mb-3"></i>
                    <h5>What would you like to do with this Kaizen suggestion?</h5>
                    <p class="text-muted">Please select your decision below</p>
                </div>
                <div class="d-flex justify-content-center gap-3">
                    <button type="button" class="btn btn-approve btn-lg" onclick="showNameInput('approve')">
                        <i class="fas fa-check me-2"></i>Approve
                    </button>
                    <button type="button" class="btn btn-reject btn-lg" onclick="showNameInput('reject')">
                        <i class="fas fa-times me-2"></i>Reject
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Name Input Modal -->
<div class="modal fade" id="nameInputModal" tabindex="-1" aria-labelledby="nameInputModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="nameInputModalLabel">
                    <i class="fas fa-user me-2"></i>Enter Your Name
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="userNameInput" class="form-label">
                        <i class="fas fa-signature me-2"></i>Your Name
                    </label>
                    <input type="text" id="userNameInput" class="form-control" placeholder="Enter your full name" required />
                    <div class="invalid-feedback">
                        Please enter your name.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" id="confirmActionBtn" onclick="confirmAction()">
                    <i class="fas fa-check me-2"></i>Confirm
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Manager Comment Modal -->
<div class="modal fade" id="managerCommentModal" tabindex="-1" aria-labelledby="managerCommentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="managerCommentModalLabel">
                    <i class="fas fa-comments me-2"></i>Manager Comment
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="managerCommentForm">
                    <input type="hidden" id="managerCommentKaizenId" name="KaizenId" />
                    
                    <div class="mb-3">
                        <label for="managerCommentText" class="form-label">
                            <i class="fas fa-comment-dots me-2"></i>Comments & Recommendations
                        </label>
                        <textarea id="managerCommentText" name="Comments" class="form-control" rows="4" 
                                  placeholder="Enter your comments and recommendations..." required></textarea>
                        <div class="invalid-feedback">
                            Please provide comments and recommendations.
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="managerSignature" class="form-label">
                            <i class="fas fa-signature me-2"></i>Enter Name for Signature
                        </label>
                        <input type="text" id="managerSignature" name="Signature" class="form-control" 
                               placeholder="Enter your name for signature" required />
                        <div class="invalid-feedback">
                            Please enter your name for signature.
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <button type="button" class="btn btn-manager" onclick="saveManagerComment()">
                    <i class="fas fa-save me-2"></i>Save Comment
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Manager Comment Display Modal -->
<div class="modal fade" id="managerCommentDisplayModal" tabindex="-1" aria-labelledby="managerCommentDisplayModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="managerCommentDisplayModalLabel">
                    <i class="fas fa-comments me-2"></i>Manager Comments
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-4" style="border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; background-color: #f8f9fa;">
                    <h6 class="mb-3">
                        <i class="fas fa-user-tie me-2"></i>Manager Review
                    </h6>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-comment-dots me-2"></i>Comments & Recommendations
                        </label>
                        <div class="form-control" style="background-color: white; min-height: 100px; border: 1px solid #ced4da;">
                            <p id="displayManagerComments" class="mb-0"></p>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-signature me-2"></i>Manager Signature
                        </label>
                        <div class="form-control" style="background-color: white; border: 1px solid #ced4da;">
                            <p id="displayManagerSignature" class="mb-0 fw-bold"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Close
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

<script>
    // Real-time search functionality
    let searchTimeout;
    const searchInput = document.getElementById('searchString');
    const statusSelect = document.getElementById('status');
    const clearBtn = document.getElementById('clearBtn');
    const searchResults = document.getElementById('searchResults');

    // Search function with debouncing
    function performSearch() {
        const searchTerm = searchInput.value.trim();
        const status = statusSelect.value;

        // Show loading state
        searchResults.innerHTML = `
            <div class="text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Searching...</p>
            </div>
        `;

        // Make AJAX request
        fetch(`/Kaizen/Search?searchString=${encodeURIComponent(searchTerm)}&status=${encodeURIComponent(status)}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    displaySearchResults(data.kaizens, searchTerm, status);
                } else {
                    searchResults.innerHTML = `
                        <div class="no-data-alert">
                            <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                            <h4>Error occurred</h4>
                            <p class="mb-0">${data.message}</p>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Search error:', error);
                searchResults.innerHTML = `
                    <div class="no-data-alert">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <h4>Search failed</h4>
                        <p class="mb-0">An error occurred while searching. Please try again.</p>
                    </div>
                `;
            });
    }

    // Display search results
    function displaySearchResults(kaizens, searchTerm, status) {
        if (!kaizens || kaizens.length === 0) {
            let message = 'No Kaizen suggestions found';
            if (searchTerm || status) {
                message += ` for "${searchTerm || status}"`;
            }
            searchResults.innerHTML = `
                <div class="no-data-alert">
                    <i class="fas fa-search fa-3x mb-3"></i>
                    <h4>${message}</h4>
                    <p class="mb-0">Try adjusting your search criteria</p>
                </div>
            `;
            return;
        }

        const tableHTML = `
            <div class="table-responsive">
                <table class="table kaizen-table">
                    <thead>
                        <tr>
                            <th><i class="fas fa-calendar me-2"></i>Date Submitted</th>
                            <th><i class="fas fa-hashtag me-2"></i>Kaizen No</th>
                            <th><i class="fas fa-building me-2"></i>Department Name</th>
                            <th><i class="fas fa-user me-2"></i>Employee Name</th>
                            <th><i class="fas fa-id-badge me-2"></i>Employee No</th>
                            <th><i class="fas fa-coins me-2"></i>Cost Saving</th>
                            <th><i class="fas fa-info-circle me-2"></i>Manager Status</th>
                            <th><i class="fas fa-cogs me-2"></i>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${kaizens.map(item => {
                            const managerStatus = item.managerStatus || 'Pending';
                            const statusClass = managerStatus === 'Approved' ? 'status-approved' :
                                               managerStatus === 'Rejected' ? 'status-rejected' : 'status-pending';
                            return `
                                <tr>
                                    <td class="text-center">${new Date(item.dateSubmitted).toLocaleDateString()}</td>
                                    <td class="text-center fw-bold">${item.kaizenNo}</td>
                                    <td class="text-center">${item.department}</td>
                                    <td>${item.employeeName}</td>
                                    <td class="text-center">${item.employeeNo}</td>
                                    <td class="text-center cost-saving">
                                        ${item.costSaving ? `$ ${parseFloat(item.costSaving).toFixed(2)}` : 'N/A'}
                                    </td>
                                    <td class="text-center">
                                        <span class="${statusClass}">${managerStatus}</span>
                                    </td>
                                    <td class="text-center">
                                        <button class="btn btn-view" onclick="viewKaizen(${item.id})">
                                            <i class="fas fa-eye me-1"></i>View
                                        </button>
                                        ${managerStatus === 'Pending' ? `
                                            <button class="btn btn-approval" onclick="showApprovalPopup(${item.id})">
                                                <i class="fas fa-gavel me-1"></i>Approval
                                            </button>
                                        ` : ''}

                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        `;

        searchResults.innerHTML = tableHTML;
    }

    // Event listeners
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(performSearch, 300); // 300ms delay
    });

    statusSelect.addEventListener('change', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(performSearch, 300);
    });

    clearBtn.addEventListener('click', function() {
        searchInput.value = '';
        statusSelect.value = '';
        performSearch();
    });

    // Load initial data
    document.addEventListener('DOMContentLoaded', function() {
        performSearch();

        // Add event listeners for cost saving radio buttons in edit modal
        const editNoCostSavingRadio = document.getElementById('editNoCostSaving');
        const editHasCostSavingRadio = document.getElementById('editHasCostSaving');
        const editCostSavingFields = document.getElementById('editCostSavingFields');

        if (editNoCostSavingRadio && editHasCostSavingRadio) {
            editNoCostSavingRadio.addEventListener('change', function() {
                if (this.checked) {
                    editCostSavingFields.style.display = 'none';
                    // Clear the values when hidden
                    document.getElementById('editCostSaving').value = '';
                    document.getElementById('editDollarRate').value = '';
                }
            });

            editHasCostSavingRadio.addEventListener('change', function() {
                if (this.checked) {
                    editCostSavingFields.style.display = 'block';
                }
            });
        }
    });

    function viewKaizen(id) {
        // Show loading state
        const modal = new bootstrap.Modal(document.getElementById('editKaizenModal'));
        modal.show();

        // Reset form to view-only mode
        setFormReadOnly(true);
        document.getElementById('saveEditBtn').style.display = 'none';
        document.getElementById('executiveFillingBtn').style.display = 'none';
        document.getElementById('managerCommentBtn').style.display = 'none';

        // Fetch kaizen data
        fetch(`/Kaizen/Edit/${id}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Populate form fields
                    document.getElementById('editKaizenId').value = data.data.id;
                    document.getElementById('editKaizenNo').value = data.data.kaizenNo;
                    document.getElementById('editDateSubmitted').value = data.data.dateSubmitted.split('T')[0];
                    document.getElementById('editDateImplemented').value = data.data.dateImplemented ? data.data.dateImplemented.split('T')[0] : '';
                    document.getElementById('editDepartment').value = data.data.department;
                    document.getElementById('editEmployeeName').value = data.data.employeeName;
                    document.getElementById('editEmployeeNo').value = data.data.employeeNo;
                    document.getElementById('editSuggestionDescription').value = data.data.suggestionDescription || '';
                    document.getElementById('editCostSavingDisplay').value = data.data.costSaving ? `$${data.data.costSaving}` : 'N/A';
                    document.getElementById('editDollarRateDisplay').value = data.data.dollarRate ? `$${data.data.dollarRate}` : 'N/A';
                    document.getElementById('editOtherBenefits').value = data.data.otherBenefits || '';

                    // Handle existing images
                    const beforeImageContainer = document.getElementById('editBeforeKaizenImageContainer');
                    const afterImageContainer = document.getElementById('editAfterKaizenImageContainer');
                    const beforeImage = document.getElementById('editBeforeKaizenCurrentImage');
                    const afterImage = document.getElementById('editAfterKaizenCurrentImage');

                    // Show/hide before image
                    if (data.data.beforeKaizenImagePath) {
                        beforeImage.src = data.data.beforeKaizenImagePath;
                        beforeImageContainer.style.display = 'block';
                    } else {
                        beforeImageContainer.style.display = 'none';
                    }

                    // Show/hide after image
                    if (data.data.afterKaizenImagePath) {
                        afterImage.src = data.data.afterKaizenImagePath;
                        afterImageContainer.style.display = 'block';
                    } else {
                        afterImageContainer.style.display = 'none';
                    }

                    // Check if kaizen is pending and hide buttons accordingly
                    const managerStatus = data.data.managerStatus || 'Pending';
                    if (managerStatus !== 'Pending') {
                        document.getElementById('executiveFillingBtn').style.display = 'block';
                        document.getElementById('managerCommentBtn').style.display = 'block';
                    }

                    // Check if manager comments exist and update button accordingly
                    const managerCommentBtn = document.getElementById('managerCommentBtn');
                    if (data.data.managerComments && data.data.managerComments.trim() !== '') {
                        // Manager comments exist - show "View Manager Comments" button
                        managerCommentBtn.innerHTML = '<i class="fas fa-comments me-1"></i>View Manager Comments';
                        managerCommentBtn.onclick = function() {
                            showManagerCommentDisplay(data.data.managerComments, data.data.managerSignature);
                        };
                        managerCommentBtn.style.display = 'block';
                    } else {
                        // No manager comments - show "Add Manager Comment" button
                        managerCommentBtn.innerHTML = '<i class="fas fa-comments me-1"></i>Add Manager Comment';
                        managerCommentBtn.onclick = function() {
                            managerComment();
                        };
                        managerCommentBtn.style.display = 'block';
                    }
                } else {
                    alert('Error: ' + data.message);
                    modal.hide();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while loading the kaizen data.');
                modal.hide();
            });
    }



    function executiveFilling() {
        // Get the current kaizen ID from the edit modal
        const kaizenId = document.getElementById('editKaizenId').value;

        // Close the current modal
        bootstrap.Modal.getInstance(document.getElementById('editKaizenModal')).hide();

        // Show the enhanced edit modal (Executive/Engineer form)
        const enhancedModal = new bootstrap.Modal(document.getElementById('enhancedEditModal'));
        enhancedModal.show();

        // Clear the form first
        clearExecutiveForm();

        // Fetch kaizen data for enhanced edit
        fetch(`/Kaizen/Edit/${kaizenId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Populate form fields
                    document.getElementById('enhancedEditKaizenId').value = data.data.id;

                    // Populate hidden fields for form submission
                    document.getElementById('enhancedEditKaizenNoHidden').value = data.data.kaizenNo || '';
                    document.getElementById('enhancedEditEmployeeNoHidden').value = data.data.employeeNo || '';
                    document.getElementById('enhancedEditEmployeeNameHidden').value = data.data.employeeName || '';
                    document.getElementById('enhancedEditSuggestionDescriptionHidden').value = data.data.suggestionDescription || '';
                    document.getElementById('enhancedEditDateSubmittedHidden').value = data.data.dateSubmitted || '';

                    // Set category checkboxes (handle multiple selections)
                    const category = data.data.category || '';
                    if (category) {
                        // Split comma-separated categories and check corresponding checkboxes
                        const categories = category.split(',').map(cat => cat.trim());
                        categories.forEach(cat => {
                            // Use the enhanced modal checkboxes
                            const checkbox = document.querySelector(`#enhancedEditModal input[name="Category"][value="${cat}"]`);
                            if (checkbox) {
                                checkbox.checked = true;
                            }
                        });
                    }

                    // Set signature field
                                                    document.getElementById('enhancedEditApprovedBy').value = data.data.engineerApprovedBy || '';

                    // Set comments field
                    document.getElementById('enhancedEditComments').value = data.data.comments || '';

                    // Set implementation area fields
                    const canImplement = data.data.canImplementInOtherFields || '';
                    if (canImplement === 'Yes') {
                        document.getElementById('enhanced_implementYes').checked = true;
                        document.getElementById('implementationAreaField').style.display = 'block';
                        document.getElementById('enhancedEditImplementationArea').value = data.data.implementationArea || '';
                    } else if (canImplement === 'No') {
                        document.getElementById('enhanced_implementNo').checked = true;
                        document.getElementById('implementationAreaField').style.display = 'none';
                    }

                    // Hide save button since form is read-only
                    document.getElementById('saveExecutiveBtn').style.display = 'none';
                } else {
                    alert('Error: ' + data.message);
                    enhancedModal.hide();
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while loading the kaizen data.');
                enhancedModal.hide();
            });
    }

    function setFormReadOnly(readonly) {
        const form = document.getElementById('editKaizenForm');
        const inputs = form.querySelectorAll('input, textarea, select');

        inputs.forEach(input => {
            if (input.id !== 'editKaizenId' && input.id !== 'editKaizenNo') {
                input.readOnly = readonly;
                input.disabled = readonly;
            }
        });

        // Handle radio buttons and file inputs separately
        const radioButtons = form.querySelectorAll('input[type="radio"]');
        const fileInputs = form.querySelectorAll('input[type="file"]');

        radioButtons.forEach(radio => {
            radio.disabled = readonly;
        });

        fileInputs.forEach(fileInput => {
            fileInput.disabled = readonly;
        });
    }

    function saveKaizenEdit() {
        const form = document.getElementById('editKaizenForm');
        const formData = new FormData(form);
        const id = document.getElementById('editKaizenId').value;

        // Add antiforgery token
        const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
        formData.append('__RequestVerificationToken', token);

        fetch(`/Kaizen/Edit/${id}`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                bootstrap.Modal.getInstance(document.getElementById('editKaizenModal')).hide();
                // Reload the page to show updated data
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while saving the changes.');
        });
    }

    // Global variable to store current kaizen ID for approval
    let currentKaizenId = null;

    function showApprovalPopup(id) {
        currentKaizenId = id;
        const modal = new bootstrap.Modal(document.getElementById('approvalModal'));
        modal.show();
    }

    function showNameInput(action) {
        // Clear the input field
        document.getElementById('userNameInput').value = '';
        
        const modal = new bootstrap.Modal(document.getElementById('nameInputModal'));
        modal.show();
        
        // Set the onclick handler for the confirm button
        document.getElementById('confirmActionBtn').onclick = function() {
            const name = document.getElementById('userNameInput').value.trim();
            if (name) {
                if (action === 'approve') {
                    approveKaizen(currentKaizenId, name);
                } else if (action === 'reject') {
                    rejectKaizen(currentKaizenId, name);
                }
                modal.hide();
            } else {
                alert('Please enter your name to confirm the action.');
                document.getElementById('userNameInput').focus();
            }
        };
    }

    function confirmAction() {
        // This function is now handled by the onclick attribute of confirmActionBtn
        // It will be called when the user clicks the confirm button in the nameInputModal
    }


    function approveKaizen(id, name) {
        if (!id) return;

        if (confirm(`Are you sure you want to approve this Kaizen suggestion?`)) {
            fetch(`/Kaizen/UpdateManagerStatus/${id}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ managerStatus: 'Approved', managerApprovedBy: name })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Kaizen suggestion approved successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('approvalModal')).hide();
                    location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while approving the suggestion.');
            });
        }
    }

    function rejectKaizen(id, name) {
        if (!id) return;

        if (confirm(`Are you sure you want to reject this Kaizen suggestion?`)) {
            fetch(`/Kaizen/UpdateManagerStatus/${id}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ managerStatus: 'Rejected', managerApprovedBy: name })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Kaizen suggestion rejected successfully!');
                    bootstrap.Modal.getInstance(document.getElementById('approvalModal')).hide();
                    location.reload();
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while rejecting the suggestion.');
            });
        }
    }

    // Manager Comment functionality
    function managerComment() {
        // Get the current kaizen ID from the edit modal
        const kaizenId = document.getElementById('editKaizenId').value;
        if (!kaizenId) {
            alert('No Kaizen selected. Please select a Kaizen first.');
            return;
        }

        // Fetch current kaizen data to check for existing manager comments
        fetch(`/Kaizen/Edit/${kaizenId}`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Check if manager comments already exist for this specific kaizen
                    if (data.data.managerComments && data.data.managerComments.trim() !== '') {
                        // Show existing manager comments in display modal for this specific kaizen
                        showManagerCommentDisplay(data.data.managerComments, data.data.managerSignature);
                    } else {
                        // Show input form for new manager comments for this specific kaizen
                        document.getElementById('managerCommentKaizenId').value = kaizenId;
                        bootstrap.Modal.getInstance(document.getElementById('editKaizenModal')).hide();
                        const managerModal = new bootstrap.Modal(document.getElementById('managerCommentModal'));
                        managerModal.show();
                    }
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while loading the kaizen data.');
            });
    }

    function showManagerCommentDisplay(comments, signature) {
        // Populate the display modal with manager comment data for this specific kaizen
        document.getElementById('displayManagerComments').textContent = comments || 'No comments available';
        document.getElementById('displayManagerSignature').textContent = signature || 'No signature available';
        
        // Show the display modal
        const displayModal = new bootstrap.Modal(document.getElementById('managerCommentDisplayModal'));
        displayModal.show();
    }



    function saveManagerComment() {
        // Get the kaizen ID
        const kaizenId = document.getElementById('managerCommentKaizenId').value;
        
        // Validate form
        const comments = document.getElementById('managerCommentText').value.trim();
        const signature = document.getElementById('managerSignature').value.trim();
        
        if (!comments) {
            alert('Please provide comments and recommendations.');
            document.getElementById('managerCommentText').focus();
            return;
        }
        
        if (!signature) {
            alert('Please enter your name for signature.');
            document.getElementById('managerSignature').focus();
            return;
        }

        // Show loading state
        const saveBtn = document.querySelector('#managerCommentModal .btn-manager');
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
        saveBtn.disabled = true;

        // Prepare form data
        const formData = new FormData();
        formData.append('Comments', comments);
        formData.append('Signature', signature);
        formData.append('__RequestVerificationToken', document.querySelector('input[name="__RequestVerificationToken"]').value);

        // Send the data to the server
        fetch(`/Kaizen/SaveManagerComment/${kaizenId}`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Manager comment saved successfully!');
                bootstrap.Modal.getInstance(document.getElementById('managerCommentModal')).hide();
                
                // Clear the form
                document.getElementById('managerCommentText').value = '';
                document.getElementById('managerSignature').value = '';
                
                // Update the button text to "View Manager Comments" for this specific kaizen
                const managerCommentBtn = document.getElementById('managerCommentBtn');
                managerCommentBtn.innerHTML = '<i class="fas fa-comments me-1"></i>View Manager Comments';
                managerCommentBtn.onclick = function() {
                    showManagerCommentDisplay(comments, signature);
                };
                
                // Reload the page to show updated data
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while saving the manager comment.');
        })
        .finally(() => {
            // Restore button state
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        });
    }

    function saveExecutiveFilling() {
        // Get the kaizen ID
        const kaizenId = document.getElementById('enhancedEditKaizenId').value;
        
        // Validate form
        const approvedBy = document.getElementById('enhancedEditApprovedBy').value.trim();
        const comments = document.getElementById('enhancedEditComments').value.trim();
        const canImplementInOtherFields = document.querySelector('input[name="CanImplementInOtherFields"]:checked')?.value;
        const selectedCategories = document.querySelectorAll('#enhancedEditModal input[name="Category"]:checked');
        
        if (!approvedBy) {
            alert('Please enter your name for signature.');
            document.getElementById('enhancedEditApprovedBy').focus();
            return;
        }
        
        if (!comments) {
            alert('Please provide comments and recommendations.');
            document.getElementById('enhancedEditComments').focus();
            return;
        }

        if (selectedCategories.length === 0) {
            alert('Please select at least one recommended category.');
            return;
        }

        if (!canImplementInOtherFields) {
            alert('Please select whether this suggestion can be implemented in other fields.');
            return;
        }

        // Show loading state
        const saveBtn = document.getElementById('saveExecutiveBtn');
        const originalText = saveBtn.innerHTML;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
        saveBtn.disabled = true;

        // Prepare form data
        const formData = new FormData();
        
        // Add category checkboxes from enhanced modal
        const categoryCheckboxes = document.querySelectorAll('#enhancedEditModal input[name="Category"]:checked');
        categoryCheckboxes.forEach(checkbox => {
            formData.append('Category', checkbox.value);
        });
        
        formData.append('ApprovedBy', approvedBy);
        formData.append('Comments', comments);
        formData.append('CanImplementInOtherFields', canImplementInOtherFields);
        
        // Add implementation area if "Yes" is selected
        if (canImplementInOtherFields === 'Yes') {
            const implementationArea = document.getElementById('enhancedEditImplementationArea').value.trim();
            formData.append('ImplementationArea', implementationArea);
        }
        
        formData.append('__RequestVerificationToken', document.querySelector('input[name="__RequestVerificationToken"]').value);

        // Send the data to the server
        fetch(`/Kaizen/SaveExecutiveFilling/${kaizenId}`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Executive review saved successfully!');
                bootstrap.Modal.getInstance(document.getElementById('enhancedEditModal')).hide();
                
                // Reload the page to show updated data
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while saving the executive review.');
        })
        .finally(() => {
            // Restore button state
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        });
    }

    function toggleImplementationArea() {
        const implementYes = document.getElementById('implementYes');
        const implementationAreaField = document.getElementById('implementationAreaField');
        
        if (implementYes.checked) {
            implementationAreaField.style.display = 'block';
        } else {
            implementationAreaField.style.display = 'none';
            document.getElementById('enhancedEditImplementationArea').value = '';
        }
    }

    function clearExecutiveForm() {
        // Clear all category checkboxes
        const categoryCheckboxes = document.querySelectorAll('#enhancedEditModal input[name="Category"]');
        categoryCheckboxes.forEach(checkbox => {
            checkbox.checked = false;
        });

        // Clear signature field
        document.getElementById('enhancedEditApprovedBy').value = '';

        // Clear comments field
        document.getElementById('enhancedEditComments').value = '';

        // Clear radio buttons
        const radioButtons = document.querySelectorAll('#enhancedEditModal input[name="CanImplementInOtherFields"]');
        radioButtons.forEach(radio => {
            radio.checked = false;
        });

        // Hide implementation area field
        document.getElementById('implementationAreaField').style.display = 'none';
        document.getElementById('enhancedEditImplementationArea').value = '';
    }

    function toggleEnhancedImplementationArea() {
        const implementYes = document.getElementById('enhanced_implementYes');
        const implementationAreaField = document.getElementById('implementationAreaField');
        
        if (implementYes.checked) {
            implementationAreaField.style.display = 'block';
        } else {
            implementationAreaField.style.display = 'none';
            document.getElementById('enhancedEditImplementationArea').value = '';
        }
    }




</script> 