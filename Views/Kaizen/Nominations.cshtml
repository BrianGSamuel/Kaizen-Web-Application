@model List<KaizenWebApp.Models.KaizenForm>
@{
    ViewData["Title"] = "Nominations";
    Layout = "_KaizenTeamLayout";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="admin-card">
                
                <!-- Header Section -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">
                        <i class="fas fa-star text-warning me-2"></i>
                        Nominations
                    </h4>
                </div>

                <!-- Success/Error Messages -->
                @if (TempData["SubmissionSuccessMessage"] != null)
                {
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="fas fa-check-circle me-2"></i>
                        @TempData["SubmissionSuccessMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                @if (TempData["SubmissionErrorMessage"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        @TempData["SubmissionErrorMessage"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                }

                <!-- Filter Section -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-filter me-2"></i>
                            Filter Options
                        </h6>
                    </div>
                    <div class="card-body">
                        <form method="get" class="row g-3">
                            <div class="col-md-3">
                                <label for="startDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="startDate" name="startDate" 
                                       value="@Context.Request.Query["startDate"]">
                            </div>
                            <div class="col-md-3">
                                <label for="endDate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="endDate" name="endDate" 
                                       value="@Context.Request.Query["endDate"]">
                            </div>
                                                         <div class="col-md-2">
                                 <label for="department" class="form-label">Department</label>
                                 <select class="form-select" id="department" name="department">
                                     <option value="">All Departments</option>
                                     @{
                                         var selectedDept = Context.Request.Query["department"].ToString();
                                     }
                                     @if (selectedDept == "Production")
                                     {
                                         <option value="Production" selected>Production</option>
                                     }
                                     else
                                     {
                                         <option value="Production">Production</option>
                                     }
                                     @if (selectedDept == "Quality")
                                     {
                                         <option value="Quality" selected>Quality</option>
                                     }
                                     else
                                     {
                                         <option value="Quality">Quality</option>
                                     }
                                     @if (selectedDept == "Maintenance")
                                     {
                                         <option value="Maintenance" selected>Maintenance</option>
                                     }
                                     else
                                     {
                                         <option value="Maintenance">Maintenance</option>
                                     }
                                     @if (selectedDept == "Engineering")
                                     {
                                         <option value="Engineering" selected>Engineering</option>
                                     }
                                     else
                                     {
                                         <option value="Engineering">Engineering</option>
                                     }
                                     @if (selectedDept == "Safety")
                                     {
                                         <option value="Safety" selected>Safety</option>
                                     }
                                     else
                                     {
                                         <option value="Safety">Safety</option>
                                     }
                                     @if (selectedDept == "Other")
                                     {
                                         <option value="Other" selected>Other</option>
                                     }
                                     else
                                     {
                                         <option value="Other">Other</option>
                                     }
                                 </select>
                             </div>
                                                         <div class="col-md-2">
                                 <label for="category" class="form-label">Category</label>
                                 <select class="form-select" id="category" name="category">
                                     <option value="">All Categories</option>
                                     @{
                                         var selectedCat = Context.Request.Query["category"].ToString();
                                     }
                                     @if (selectedCat == "Cost Reduction")
                                     {
                                         <option value="Cost Reduction" selected>Cost Reduction</option>
                                     }
                                     else
                                     {
                                         <option value="Cost Reduction">Cost Reduction</option>
                                     }
                                     @if (selectedCat == "Quality Improvement")
                                     {
                                         <option value="Quality Improvement" selected>Quality Improvement</option>
                                     }
                                     else
                                     {
                                         <option value="Quality Improvement">Quality Improvement</option>
                                     }
                                     @if (selectedCat == "Safety Enhancement")
                                     {
                                         <option value="Safety Enhancement" selected>Safety Enhancement</option>
                                     }
                                     else
                                     {
                                         <option value="Safety Enhancement">Safety Enhancement</option>
                                     }
                                     @if (selectedCat == "Process Improvement")
                                     {
                                         <option value="Process Improvement" selected>Process Improvement</option>
                                     }
                                     else
                                     {
                                         <option value="Process Improvement">Process Improvement</option>
                                     }
                                     @if (selectedCat == "5S Implementation")
                                     {
                                         <option value="5S Implementation" selected>5S Implementation</option>
                                     }
                                     else
                                     {
                                         <option value="5S Implementation">5S Implementation</option>
                                     }
                                     @if (selectedCat == "Other")
                                     {
                                         <option value="Other" selected>Other</option>
                                     }
                                     else
                                     {
                                         <option value="Other">Other</option>
                                     }
                                 </select>
                             </div>
                                                         <div class="col-md-2">
                                 <label for="nominationStatus" class="form-label">Nomination Status</label>
                                 <select class="form-select" id="nominationStatus" name="nominationStatus">
                                     <option value="">All Status</option>
                                     @{
                                         var selectedNomStatus = Context.Request.Query["nominationStatus"].ToString();
                                     }
                                     @if (selectedNomStatus == "Pending")
                                     {
                                         <option value="Pending" selected>Pending</option>
                                     }
                                     else
                                     {
                                         <option value="Pending">Pending</option>
                                     }
                                     @if (selectedNomStatus == "Nominated")
                                     {
                                         <option value="Nominated" selected>Nominated</option>
                                     }
                                     else
                                     {
                                         <option value="Nominated">Nominated</option>
                                     }
                                 </select>
                             </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary me-2">
                                    <i class="fas fa-search me-2"></i>
                                    Apply Filters
                                </button>
                                <a href="@Url.Action("Nominations")" class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-2"></i>
                                    Clear Filters
                                </a>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-star me-2"></i>
                                Kaizen Suggestions for Nomination
                            </h5>
                            <span class="badge bg-light text-dark">@Model.Count items</span>
                        </div>
                    </div>
                    <div class="card-body">
                        @if (!Model.Any())
                        {
                            <div class="text-center py-5">
                                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">No kaizen suggestions found</h5>
                                <p class="text-muted">Try adjusting your filters or check back later.</p>
                            </div>
                        }
                        else
                        {
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Kaizen No</th>
                                            <th>Employee</th>
                                            <th>Department</th>
                                            <th>Category</th>
                                            <th>Date Submitted</th>
                                            <th>Cost Saving</th>
                                            <th>Current Score</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var kaizen in Model)
                                        {
                                            <tr>
                                                <td>
                                                    <strong class="text-primary">@kaizen.KaizenNo</strong>
                                                </td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        @if (!string.IsNullOrEmpty(kaizen.EmployeePhotoPath))
                                                        {
                                                            <img src="@kaizen.EmployeePhotoPath" 
                                                                 alt="Employee Photo" 
                                                                 class="rounded-circle me-2" 
                                                                 style="width: 30px; height: 30px; object-fit: cover;">
                                                        }
                                                        else
                                                        {
                                                            <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center me-2" 
                                                                 style="width: 30px; height: 30px;">
                                                                <i class="fas fa-user text-white" style="font-size: 12px;"></i>
                                                            </div>
                                                        }
                                                        <div>
                                                            <div class="fw-bold">@kaizen.EmployeeName</div>
                                                            <small class="text-muted">@kaizen.EmployeeNo</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span class="badge bg-info">@kaizen.Department</span>
                                                </td>
                                                <td>@kaizen.Category</td>
                                                <td>@kaizen.DateSubmitted.ToString("MMM dd, yyyy")</td>
                                                <td>
                                                    @if (kaizen.CostSaving.HasValue && kaizen.CostSaving > 0)
                                                    {
                                                        <span class="text-success fw-bold">$@kaizen.CostSaving.Value.ToString("N2")</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="text-muted">No cost saving</span>
                                                    }
                                                </td>
                                                <td>
                                                    @{
                                                        var percentage = ViewBag.Percentage as double? ?? 0;
                                                        var badgeClass = percentage >= 75 ? "bg-success" : 
                                                                       percentage >= 65 ? "bg-warning" : "bg-secondary";
                                                    }
                                                    <span class="badge @badgeClass">
                                                        <i class="fas fa-chart-line me-1"></i>
                                                        @percentage.ToString("F1")%
                                                    </span>
                                                </td>
                                                <td>
                                                    @if (string.IsNullOrEmpty(kaizen.AwardPrice))
                                                    {
                                                        <span class="badge bg-warning">Pending</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-success">Nominated</span>
                                                    }
                                                </td>
                                                <td>
                                                    <a href="@Url.Action("NominationDetails", "Kaizen", new { id = kaizen.Id })" 
                                                       class="btn btn-sm btn-outline-warning">
                                                        <i class="fas fa-star me-1"></i>
                                                        View Details
                                                    </a>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
