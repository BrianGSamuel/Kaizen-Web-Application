@model KaizenWebApp.ViewModels.RegisterViewModel
@{
    ViewData["Title"] = "Register New User";
    Layout = "_SupervisorLayout";
}

<div class="supervisor-card fade-in">
    <div class="supervisor-card-header">
        <h3 class="supervisor-card-title">
            <i class="fas fa-user-plus me-2"></i>Register New User
        </h3>
        <p class="text-muted mb-0">Create a new user account for the Kaizen system</p>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["AlertMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            @TempData["AlertMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <form asp-action="RegisterUser" method="post" class="needs-validation" novalidate>
        <!-- Hidden field for Role - always "User" for supervisor registrations -->
        <input type="hidden" asp-for="Role" value="User" />
        <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="EmployeeName" class="form-label">
                    <i class="fas fa-user me-1"></i>Employee Name
                </label>
                <input asp-for="EmployeeName" class="form-control" placeholder="Enter employee name" required />
                <span asp-validation-for="EmployeeName" class="text-danger"></span>
                <div class="invalid-feedback">
                    Please provide a valid employee name.
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="EmployeeNumber" class="form-label">
                    <i class="fas fa-id-card me-1"></i>Employee Number
                </label>
                <input asp-for="EmployeeNumber" class="form-control" placeholder="Enter employee number" required />
                <span asp-validation-for="EmployeeNumber" class="text-danger"></span>
                <div class="invalid-feedback">
                    Please provide a valid employee number.
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="Username" class="form-label">
                    <i class="fas fa-user me-1"></i>Username
                </label>
                <input asp-for="Username" class="form-control" placeholder="Username will be auto-generated" readonly />
                <span asp-validation-for="Username" class="text-danger"></span>
                <div class="invalid-feedback">
                    Username is required.
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="Department" class="form-label">
                    <i class="fas fa-building me-1"></i>Department
                </label>
                <input asp-for="Department" class="form-control" placeholder="Enter department name" required />
                <span asp-validation-for="Department" class="text-danger"></span>
                <div class="invalid-feedback">
                    Please enter a department name.
                </div>
                <small class="form-text text-muted">
                    <i class="fas fa-info-circle me-1"></i>Type the department name (e.g., Production, Quality, Maintenance)
                </small>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="Plant" class="form-label">
                    <i class="fas fa-industry me-1"></i>Plant
                </label>
                <input asp-for="Plant" class="form-control" placeholder="Enter plant name" required />
                <span asp-validation-for="Plant" class="text-danger"></span>
                <div class="invalid-feedback">
                    Please enter a plant name.
                </div>
                <small class="form-text text-muted">
                    <i class="fas fa-info-circle me-1"></i>Type the plant name (e.g., Plant 1, Plant 2, Head Office)
                </small>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-user-tag me-1"></i>Role
                    </label>
                    <input type="text" class="form-control" value="User" readonly />
                    <small class="form-text text-muted">
                        <i class="fas fa-info-circle me-1"></i>Supervisors can only register regular users
                    </small>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="Password" class="form-label">
                    <i class="fas fa-lock me-1"></i>Password
                </label>
                <input asp-for="Password" type="password" class="form-control" placeholder="Enter password" required />
                <span asp-validation-for="Password" class="text-danger"></span>
                <div class="invalid-feedback">
                    Please provide a valid password (minimum 8 characters).
                </div>
                <small class="form-text text-muted">
                    <i class="fas fa-info-circle me-1"></i>Password must be at least 8 characters long.
                </small>
            </div>

            <div class="col-md-6 mb-3">
                <label asp-for="ConfirmPassword" class="form-label">
                    <i class="fas fa-lock me-1"></i>Confirm Password
                </label>
                <input asp-for="ConfirmPassword" type="password" class="form-control" placeholder="Confirm password" required />
                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                <div class="invalid-feedback">
                    Please confirm your password.
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-4">
            <a asp-controller="Kaizen" asp-action="SupervisorDashboard" class="btn btn-supervisor-outline">
                <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
            </a>
            <button type="submit" class="btn btn-supervisor">
                <i class="fas fa-user-plus me-2"></i>Register User
            </button>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        // Form validation
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        // Auto-generate username when employee number is entered
        document.addEventListener('DOMContentLoaded', function() {
            const employeeNumberInput = document.getElementById('EmployeeNumber');
            const usernameInput = document.getElementById('Username');
            
            if (employeeNumberInput && usernameInput) {
                employeeNumberInput.addEventListener('input', function() {
                    const empNumber = this.value.trim();
                    if (empNumber) {
                        usernameInput.value = empNumber + '-User';
                    } else {
                        usernameInput.value = '';
                    }
                });
            }
        });

        // Auto-hide alerts after 5 seconds
        setTimeout(function() {
            var alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                var bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);


    </script>
}


